---
layout: default
title: Admin - Post Management
description: Local admin interface for managing blog posts
exclude_from_nav: true
---

{% unless jekyll.environment == 'production' %}
<div class="admin-container">
  <header class="admin-header">
    <h1>üîß Post Management</h1>
    <p class="admin-notice">‚ö†Ô∏è Development Mode Only - This interface is not available in production</p>
  </header>

  <div class="admin-tabs">
    <button class="tab-btn active" data-tab="create">Create New Post</button>
    <button class="tab-btn" data-tab="manage">Manage Posts</button>
    <button class="tab-btn" data-tab="drafts">Drafts</button>
  </div>

  <!-- Create New Post Tab -->
  <div id="create-tab" class="tab-content active">
    <form id="post-form" class="post-form">
      <div class="form-row">
        <div class="form-group">
          <label for="post-title">Post Title *</label>
          <input type="text" id="post-title" name="title" required>
        </div>
        <div class="form-group">
          <label for="post-status">Status</label>
          <select id="post-status" name="status">
            <option value="draft">Draft</option>
            <option value="published">Published</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="post-date">Publish Date</label>
          <input type="datetime-local" id="post-date" name="date" required>
        </div>
        <div class="form-group">
          <label for="post-author">Author</label>
          <input type="text" id="post-author" name="author" value="Rob Bazinet">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="post-categories">Categories</label>
          <div class="tag-input-container">
            <input type="text" id="post-categories" name="categories" placeholder="Start typing to add categories...">
            <div class="tag-suggestions" id="category-suggestions"></div>
            <div class="selected-tags" id="selected-categories"></div>
          </div>
        </div>
        <div class="form-group">
          <label for="post-tags">Tags</label>
          <div class="tag-input-container">
            <input type="text" id="post-tags" name="tags" placeholder="Start typing to add tags...">
            <div class="tag-suggestions" id="tag-suggestions"></div>
            <div class="selected-tags" id="selected-tags"></div>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="post-excerpt">Excerpt (Optional)</label>
        <textarea id="post-excerpt" name="excerpt" rows="3" placeholder="Brief description of the post..."></textarea>
      </div>

      <div class="form-group">
        <label for="post-content">Content *</label>
        <div class="editor-toolbar">
          <button type="button" class="editor-btn" data-action="bold">**B**</button>
          <button type="button" class="editor-btn" data-action="italic">*I*</button>
          <button type="button" class="editor-btn" data-action="link">Link</button>
          <button type="button" class="editor-btn" data-action="code">Code</button>
          <button type="button" class="editor-btn" data-action="heading">H2</button>
          <button type="button" class="editor-btn" data-action="list">List</button>
          <button type="button" class="editor-btn" data-action="preview">Preview</button>
        </div>
        <textarea id="post-content" name="content" required placeholder="Write your post content in Markdown..."></textarea>
        <div id="content-preview" class="content-preview" style="display: none;"></div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Generate Post File</button>
        <button type="button" class="btn btn-secondary" id="clear-form">Clear Form</button>
      </div>
    </form>
  </div>

  <!-- Manage Posts Tab -->
  <div id="manage-tab" class="tab-content">
    <div class="posts-filter">
      <input type="text" id="posts-search" placeholder="Search posts...">
      <select id="posts-category-filter">
        <option value="">All Categories</option>
      </select>
    </div>
    <div id="posts-list" class="posts-list">
      <!-- Posts will be loaded here -->
    </div>
  </div>

  <!-- Drafts Tab -->
  <div id="drafts-tab" class="tab-content">
    <div id="drafts-list" class="posts-list">
      <!-- Drafts will be loaded here -->
    </div>
  </div>

  <!-- Generated Post Modal -->
  <div id="post-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>Generated Post File</h3>
      <p>Copy this content and save it as: <strong id="filename-display"></strong></p>
      <textarea id="generated-content" readonly></textarea>
      <div class="modal-actions">
        <button type="button" class="btn btn-primary" id="copy-content">Copy to Clipboard</button>
        <button type="button" class="btn btn-secondary" id="download-file">Download File</button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize admin interface
  initializeAdmin();
});

function initializeAdmin() {
  setupTabs();
  setupEditor();
  setupTagInputs();
  setupPostForm();
  setupModal();
  loadExistingPosts();
  setupPostsFilter();
  
  // Set default date to now
  document.getElementById('post-date').value = new Date().toISOString().slice(0, 16);
}

function setupTabs() {
  const tabBtns = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const tabId = btn.dataset.tab;
      
      // Remove active class from all tabs
      tabBtns.forEach(b => b.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      
      // Add active class to clicked tab
      btn.classList.add('active');
      document.getElementById(tabId + '-tab').classList.add('active');
    });
  });
}

function setupEditor() {
  const toolbar = document.querySelector('.editor-toolbar');
  const textarea = document.getElementById('post-content');
  const preview = document.getElementById('content-preview');
  
  toolbar.addEventListener('click', (e) => {
    if (e.target.classList.contains('editor-btn')) {
      const action = e.target.dataset.action;
      handleEditorAction(action, textarea, preview);
    }
  });
}

function handleEditorAction(action, textarea, preview) {
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const selectedText = textarea.value.substring(start, end);
  let replacement = '';
  
  switch (action) {
    case 'bold':
      replacement = `**${selectedText || 'bold text'}**`;
      break;
    case 'italic':
      replacement = `*${selectedText || 'italic text'}*`;
      break;
    case 'link':
      const url = prompt('Enter URL:');
      replacement = `[${selectedText || 'link text'}](${url || 'http://'})`;
      break;
    case 'code':
      replacement = selectedText.includes('\n') ? 
        `\`\`\`\n${selectedText || 'code block'}\n\`\`\`` : 
        `\`${selectedText || 'code'}\``;
      break;
    case 'heading':
      replacement = `## ${selectedText || 'Heading'}`;
      break;
    case 'list':
      replacement = selectedText ? 
        selectedText.split('\n').map(line => `- ${line}`).join('\n') :
        '- List item 1\n- List item 2\n- List item 3';
      break;
    case 'preview':
      togglePreview(textarea, preview);
      return;
  }
  
  if (replacement) {
    textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
    textarea.focus();
    textarea.setSelectionRange(start, start + replacement.length);
  }
}

function togglePreview(textarea, preview) {
  if (preview.style.display === 'none') {
    // Show preview
    preview.innerHTML = marked(textarea.value);
    preview.style.display = 'block';
    textarea.style.display = 'none';
    document.querySelector('[data-action="preview"]').textContent = 'Edit';
  } else {
    // Show editor
    preview.style.display = 'none';
    textarea.style.display = 'block';
    document.querySelector('[data-action="preview"]').textContent = 'Preview';
  }
}

function setupTagInputs() {
  // Setup categories
  setupSingleTagInput('post-categories', 'category-suggestions', 'selected-categories', 'categories');
  // Setup tags
  setupSingleTagInput('post-tags', 'tag-suggestions', 'selected-tags', 'tags');
}

function setupSingleTagInput(inputId, suggestionsId, selectedId, type) {
  const input = document.getElementById(inputId);
  const suggestions = document.getElementById(suggestionsId);
  const selected = document.getElementById(selectedId);
  
  let selectedItems = [];
  
  input.addEventListener('input', function() {
    const query = this.value.toLowerCase();
    if (query.length > 0) {
      fetchSuggestions(query, type, suggestions, (item) => {
        if (!selectedItems.includes(item)) {
          selectedItems.push(item);
          updateSelectedDisplay(selected, selectedItems, (removedItem) => {
            selectedItems = selectedItems.filter(i => i !== removedItem);
          });
          input.value = '';
          suggestions.innerHTML = '';
        }
      });
    } else {
      suggestions.innerHTML = '';
    }
  });
  
  input.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      const value = this.value.trim();
      if (value && !selectedItems.includes(value)) {
        selectedItems.push(value);
        updateSelectedDisplay(selected, selectedItems, (removedItem) => {
          selectedItems = selectedItems.filter(i => i !== removedItem);
        });
        this.value = '';
        suggestions.innerHTML = '';
      }
    }
  });
  
  // Store reference to selectedItems for form submission
  input.dataset.selectedItems = JSON.stringify(selectedItems);
  input.addEventListener('change', () => {
    input.dataset.selectedItems = JSON.stringify(selectedItems);
  });
}

function fetchSuggestions(query, type, container, onSelect) {
  // Real categories and tags from existing posts
  const existingCategories = [
    'General', 'Technology', 'Social Media', 'Programming', 'Ruby on Rails', 
    'Development', 'Apple', 'Microsoft', 'Entrepreneurship', 'Business',
    'iOS', 'JavaScript', 'Web Development', 'Instant Rails', 'Software',
    'Hardware', 'Tools', 'Productivity', 'Ruby', 'Rails', 'Mobile',
    'Windows', 'Mac', 'Linux', 'Open Source'
  ];
  
  const existingTags = [
    'Jekyll', 'WordPress', 'Rails', 'Ruby', 'JavaScript', 'Development', 
    'Blogging', 'iOS', 'Swift', 'Objective-C', 'HTML', 'CSS', 'PHP',
    'ASP.NET', 'C#', 'SQL', 'MySQL', 'PostgreSQL', 'Git', 'GitHub',
    'Deployment', 'Testing', 'Performance', 'Security', 'API', 'REST',
    'JSON', 'XML', 'Framework', 'Library', 'Tool', 'Editor', 'IDE',
    'Server', 'Cloud', 'AWS', 'Database', 'Frontend', 'Backend',
    'Mobile', 'Android', 'iPhone', 'iPad', 'Mac', 'Windows', 'Linux'
  ];
  
  const existingItems = type === 'categories' ? existingCategories : existingTags;
  
  const matches = existingItems.filter(item => 
    item.toLowerCase().includes(query.toLowerCase())
  );
  
  container.innerHTML = matches.map(item => 
    `<div class="suggestion-item" data-value="${item}">${item}</div>`
  ).join('');
  
  container.querySelectorAll('.suggestion-item').forEach(item => {
    item.addEventListener('click', () => {
      onSelect(item.dataset.value);
    });
  });
}

function updateSelectedDisplay(container, items, onRemove) {
  container.innerHTML = items.map(item => 
    `<span class="selected-tag">${item} <button type="button" class="remove-tag" data-value="${item}">√ó</button></span>`
  ).join('');
  
  container.querySelectorAll('.remove-tag').forEach(btn => {
    btn.addEventListener('click', () => {
      onRemove(btn.dataset.value);
      updateSelectedDisplay(container, items.filter(i => i !== btn.dataset.value), onRemove);
    });
  });
}

function setupPostForm() {
  document.getElementById('post-form').addEventListener('submit', function(e) {
    e.preventDefault();
    generatePostFile();
  });
  
  document.getElementById('clear-form').addEventListener('click', function() {
    if (confirm('Are you sure you want to clear the form?')) {
      document.getElementById('post-form').reset();
      document.getElementById('selected-categories').innerHTML = '';
      document.getElementById('selected-tags').innerHTML = '';
      document.getElementById('post-date').value = new Date().toISOString().slice(0, 16);
    }
  });
}

function generatePostFile() {
  const form = document.getElementById('post-form');
  const formData = new FormData(form);
  const isEditing = form.dataset.editingPath;
  
  // Get selected categories and tags
  const categories = JSON.parse(document.getElementById('post-categories').dataset.selectedItems || '[]');
  const tags = JSON.parse(document.getElementById('post-tags').dataset.selectedItems || '[]');
  
  const title = formData.get('title');
  const date = new Date(formData.get('date'));
  const status = formData.get('status');
  const author = formData.get('author');
  const excerpt = formData.get('excerpt');
  const content = formData.get('content');
  
  // Generate filename
  const dateStr = date.toISOString().split('T')[0];
  const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
  const filename = status === 'draft' ? 
    `_drafts/${slug}.md` : 
    `_posts/${dateStr}-${slug}.md`;
  
  // Generate front matter
  let frontMatter = '---\n';
  frontMatter += `layout: post\n`;
  frontMatter += `title: "${title}"\n`;
  frontMatter += `date: ${date.toISOString()}\n`;
  frontMatter += `author: "${author}"\n`;
  
  if (categories.length > 0) {
    frontMatter += `categories: [${categories.map(c => `"${c}"`).join(', ')}]\n`;
  }
  
  if (tags.length > 0) {
    frontMatter += `tags: [${tags.map(t => `"${t}"`).join(', ')}]\n`;
  }
  
  if (excerpt) {
    frontMatter += `excerpt: "${excerpt}"\n`;
  }
  
  if (status === 'draft') {
    frontMatter += `published: false\n`;
  }
  
  frontMatter += '---\n\n';
  
  const fullContent = frontMatter + content;
  
  // Show in modal
  const modalTitle = document.querySelector('#post-modal h3');
  modalTitle.textContent = isEditing ? 'Updated Post File' : 'Generated Post File';
  
  document.getElementById('filename-display').textContent = isEditing ? form.dataset.editingPath : filename;
  document.getElementById('generated-content').value = fullContent;
  document.getElementById('post-modal').style.display = 'block';
  
  // If editing, show update message
  if (isEditing) {
    const modalP = document.querySelector('#post-modal p');
    modalP.innerHTML = `Copy this content and update the file: <strong id="filename-display">${form.dataset.editingPath}</strong><br>
                        <small>Note: The filename may have changed if you modified the title or date.</small>`;
  }
}

function setupModal() {
  const modal = document.getElementById('post-modal');
  const closeBtn = document.querySelector('.close');
  const copyBtn = document.getElementById('copy-content');
  const downloadBtn = document.getElementById('download-file');
  
  closeBtn.addEventListener('click', () => {
    modal.style.display = 'none';
  });
  
  window.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  });
  
  copyBtn.addEventListener('click', () => {
    const textarea = document.getElementById('generated-content');
    textarea.select();
    document.execCommand('copy');
    copyBtn.textContent = 'Copied!';
    setTimeout(() => {
      copyBtn.textContent = 'Copy to Clipboard';
    }, 2000);
  });
  
  downloadBtn.addEventListener('click', () => {
    const filename = document.getElementById('filename-display').textContent;
    const content = document.getElementById('generated-content').value;
    const blob = new Blob([content], { type: 'text/markdown' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename.split('/').pop(); // Just the filename, not the path
    a.click();
    URL.revokeObjectURL(url);
  });
}

function loadExistingPosts() {
  // Load existing posts via Jekyll's site data
  fetch('/admin-posts.json')
    .then(response => response.json())
    .then(data => {
      displayPosts(data.posts, 'posts-list');
      displayPosts(data.drafts, 'drafts-list');
      populateCategoryFilter(data.categories);
    })
    .catch(error => {
      console.error('Error loading posts:', error);
      document.getElementById('posts-list').innerHTML = '<p>Error loading posts. Please refresh the page.</p>';
      document.getElementById('drafts-list').innerHTML = '<p>Error loading drafts. Please refresh the page.</p>';
    });
}

function displayPosts(posts, containerId) {
  const container = document.getElementById(containerId);
  
  if (!posts || posts.length === 0) {
    container.innerHTML = '<p>No posts found.</p>';
    return;
  }
  
  container.innerHTML = posts.map(post => `
    <div class="post-item" data-id="${post.id}">
      <div class="post-item-header">
        <h3>${post.title}</h3>
        <span class="post-date">${new Date(post.date).toLocaleDateString()}</span>
      </div>
      <div class="post-meta">
        ${post.categories ? `<span class="post-categories">${post.categories.join(', ')}</span>` : ''}
        ${post.tags ? `<span class="post-tags">${post.tags.join(', ')}</span>` : ''}
      </div>
      <div class="post-excerpt">${post.excerpt || 'No excerpt available'}</div>
      <div class="post-actions">
        <button class="btn btn-sm btn-primary" onclick="editPost('${post.path}')">
          <span>‚úèÔ∏è</span> Edit
        </button>
        <button class="btn btn-sm btn-secondary" onclick="viewPost('${post.url}')">
          <span>üëÅÔ∏è</span> View
        </button>
        <button class="btn btn-sm btn-danger" onclick="deletePost('${post.path}', '${post.title}')">
          <span>üóëÔ∏è</span> Delete
        </button>
      </div>
    </div>
  `).join('');
}

function populateCategoryFilter(categories) {
  const filter = document.getElementById('posts-category-filter');
  if (filter && categories) {
    filter.innerHTML = '<option value="">All Categories</option>' + 
      categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
  }
}

function editPost(postPath) {
  // Load post content for editing
  fetch('/admin-post-content.json')
    .then(response => response.json())
    .then(data => {
      const post = data[postPath];
      if (!post) {
        throw new Error('Post not found');
      }
      // Switch to create tab
      document.querySelector('[data-tab="create"]').click();
      
      // Populate form with post data
      document.getElementById('post-title').value = post.title || '';
      document.getElementById('post-status').value = post.published === false ? 'draft' : 'published';
      document.getElementById('post-date').value = post.date ? new Date(post.date).toISOString().slice(0, 16) : '';
      document.getElementById('post-author').value = post.author || 'Rob Bazinet';
      document.getElementById('post-excerpt').value = post.excerpt || '';
      document.getElementById('post-content').value = post.content || '';
      
      // Set categories
      if (post.categories) {
        const catInput = document.getElementById('post-categories');
        catInput.dataset.selectedItems = JSON.stringify(post.categories);
        updateSelectedDisplay(
          document.getElementById('selected-categories'), 
          post.categories, 
          (removed) => {
            const items = JSON.parse(catInput.dataset.selectedItems);
            catInput.dataset.selectedItems = JSON.stringify(items.filter(i => i !== removed));
          }
        );
      }
      
      // Set tags
      if (post.tags) {
        const tagInput = document.getElementById('post-tags');
        tagInput.dataset.selectedItems = JSON.stringify(post.tags);
        updateSelectedDisplay(
          document.getElementById('selected-tags'), 
          post.tags, 
          (removed) => {
            const items = JSON.parse(tagInput.dataset.selectedItems);
            tagInput.dataset.selectedItems = JSON.stringify(items.filter(i => i !== removed));
          }
        );
      }
      
      // Store original path for updating
      document.getElementById('post-form').dataset.editingPath = postPath;
      
      // Update button text
      document.querySelector('#post-form button[type="submit"]').textContent = 'Update Post File';
      
      // Add cancel edit button if not present
      if (!document.getElementById('cancel-edit')) {
        const cancelBtn = document.createElement('button');
        cancelBtn.type = 'button';
        cancelBtn.id = 'cancel-edit';
        cancelBtn.className = 'btn btn-warning';
        cancelBtn.textContent = 'Cancel Edit';
        cancelBtn.onclick = cancelEdit;
        document.querySelector('.form-actions').appendChild(cancelBtn);
      }
    })
    .catch(error => {
      console.error('Error loading post:', error);
      alert('Error loading post for editing. Please try again.');
    });
}

function cancelEdit() {
  // Reset form
  document.getElementById('post-form').reset();
  document.getElementById('post-date').value = new Date().toISOString().slice(0, 16);
  document.getElementById('selected-categories').innerHTML = '';
  document.getElementById('selected-tags').innerHTML = '';
  
  // Remove editing path
  delete document.getElementById('post-form').dataset.editingPath;
  
  // Reset button text
  document.querySelector('#post-form button[type="submit"]').textContent = 'Generate Post File';
  
  // Remove cancel button
  const cancelBtn = document.getElementById('cancel-edit');
  if (cancelBtn) {
    cancelBtn.remove();
  }
}

function viewPost(url) {
  window.open(url, '_blank');
}

function deletePost(postPath, title) {
  if (confirm(`Are you sure you want to delete "${title}"? This action cannot be undone.`)) {
    // Note: Actual deletion would require server-side handling
    alert(`Delete functionality would remove: ${postPath}\n\nNote: This requires server-side implementation to actually delete files.`);
    // Reload posts after deletion
    // loadExistingPosts();
  }
}

// Search and filter functionality
function setupPostsFilter() {
  const searchInput = document.getElementById('posts-search');
  const categoryFilter = document.getElementById('posts-category-filter');
  
  if (searchInput) {
    searchInput.addEventListener('input', filterPosts);
  }
  
  if (categoryFilter) {
    categoryFilter.addEventListener('change', filterPosts);
  }
}

function filterPosts() {
  const searchQuery = document.getElementById('posts-search').value.toLowerCase();
  const selectedCategory = document.getElementById('posts-category-filter').value;
  
  const posts = document.querySelectorAll('#posts-list .post-item');
  
  posts.forEach(post => {
    const title = post.querySelector('h3').textContent.toLowerCase();
    const excerpt = post.querySelector('.post-excerpt').textContent.toLowerCase();
    const categories = post.querySelector('.post-categories')?.textContent || '';
    
    const matchesSearch = !searchQuery || 
      title.includes(searchQuery) || 
      excerpt.includes(searchQuery);
    
    const matchesCategory = !selectedCategory || 
      categories.includes(selectedCategory);
    
    post.style.display = matchesSearch && matchesCategory ? 'block' : 'none';
  });
}
</script>

<!-- Include Marked.js for markdown preview -->
<script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>

{% else %}
<div class="production-notice">
  <h2>üö´ Admin Interface Not Available</h2>
  <p>This admin interface is only available in development mode.</p>
  <p><a href="{{ '/' | relative_url }}">‚Üê Return to Home</a></p>
</div>
{% endunless %}