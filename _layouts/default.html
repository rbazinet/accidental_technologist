<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {%- seo -%}
    {% if page.url %}
      <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
    {% endif %}
    <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
    {%- feed_meta -%}
    {%- if jekyll.environment == 'production' and site.google_analytics -%}
      {%- include google-analytics.html -%}
    {%- endif -%}
  </head>

  <body>

    {%- include header.html -%}

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        {{ content }}
      </div>
    </main>

    {%- include footer.html -%}

  </body>

  <!-- Code block copy functionality -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // Add copy buttons to all code blocks (only outer containers)
    const codeBlocks = document.querySelectorAll('div.highlight');
    
    codeBlocks.forEach(function(codeBlock) {
      // Skip if button already exists
      if (codeBlock.querySelector('.code-copy-btn')) {
        return;
      }
      
      // Create copy button
      const copyBtn = document.createElement('button');
      copyBtn.className = 'code-copy-btn';
      copyBtn.textContent = 'Copy';
      copyBtn.setAttribute('aria-label', 'Copy code to clipboard');
      
      // Add click event
      copyBtn.addEventListener('click', function() {
        // Get the code text (exclude line numbers if present)
        const codeElement = codeBlock.querySelector('code');
        if (!codeElement) return;
        
        const codeText = codeElement.textContent || codeElement.innerText;
        
        // Copy to clipboard
        navigator.clipboard.writeText(codeText).then(function() {
          // Show success feedback
          copyBtn.textContent = 'Copied!';
          copyBtn.classList.add('copied');
          
          // Reset after 2 seconds
          setTimeout(function() {
            copyBtn.textContent = 'Copy';
            copyBtn.classList.remove('copied');
          }, 2000);
        }).catch(function(err) {
          // Fallback for older browsers
          console.error('Failed to copy: ', err);
          
          // Try the old-school way
          const textArea = document.createElement('textarea');
          textArea.value = codeText;
          document.body.appendChild(textArea);
          textArea.select();
          
          try {
            document.execCommand('copy');
            copyBtn.textContent = 'Copied!';
            copyBtn.classList.add('copied');
            
            setTimeout(function() {
              copyBtn.textContent = 'Copy';
              copyBtn.classList.remove('copied');
            }, 2000);
          } catch (e) {
            copyBtn.textContent = 'Failed';
            setTimeout(function() {
              copyBtn.textContent = 'Copy';
            }, 2000);
          }
          
          document.body.removeChild(textArea);
        });
      });
      
      // Add button to code block
      codeBlock.appendChild(copyBtn);
    });
  });
  </script>

  <!-- Dark mode toggle script -->
  <script>
  (function() {
    // Check for saved theme preference or default to light
    const currentTheme = localStorage.getItem('theme') || 'light';
    
    // Apply theme immediately to prevent flash
    if (currentTheme === 'dark') {
      document.body.classList.add('dark-mode');
    }
    
    // Theme toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
      const themeToggle = document.getElementById('theme-toggle');
      
      if (themeToggle) {
        themeToggle.addEventListener('click', function() {
          document.body.classList.toggle('dark-mode');
          const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
          localStorage.setItem('theme', theme);
        });
      }
    });
  })();
  </script>

  <!-- Header search script -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const headerSearchInput = document.getElementById('header-search-input');
    
    if (headerSearchInput) {
      // Redirect to search page on Enter key
      headerSearchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          const query = this.value.trim();
          if (query) {
            window.location.href = `/search/?q=${encodeURIComponent(query)}`;
          }
        }
      });
    }
  });
  </script>

</html>
