---
id: 364
title: 'Ruby Denial of Service (DoS) Vulnerability Options'
date: '2009-06-10T10:09:06-04:00'
author: 'Rob Bazinet'
layout: post
guid: 'http://localhost/~rbazinet/?p=364'
permalink: /ruby/ruby-denial-of-service-dos-vulnerability-options/
dsq_thread_id:
    - '21121064'
categories:
    - Ruby
---

A potentially harmful vulnerability was found in all pre-Ruby 1.9.1 version of Ruby. The issue was reported on the [Ruby-lang web site](http://www.ruby-lang.org/en/news/2009/06/09/dos-vulnerability-in-bigdecimal/) and says it effects:

> #### **1.8 series**
> 
> - 1.8.6-p368 and all prior versions
> - 1.8.7-p160 and all prior versions

Ruby 1.9.1 does not suffer from this problem but [seems apparent](http://jira.codehaus.org/browse/JRUBY-3744) JRuby does have this issue and has been [tested to prove it](http://gist.github.com/126922).

### The Problem

The issue is pretty simple to reproduce. BigDecimal, when asked to parse an overly large number, causes segmentation faults. The following will reveal the problem:

> ```
> BigDecimal("9E69999999").to_s("F")
> ```

### Solutions

There are quite a few solutions to this problem and most involve patching an existing installation of Ruby. The Ruby web site offers links to download Ruby source for both 1.8.6 and 1.8.7:

> Please upgrade to 1.8.6-p369 or ruby-1.8.7-p173.
> 
> - <ftp://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.6-p369.tar.gz>
> - <ftp://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p173.tar.gz>

There are various things to consider when doing an update like this and building from source. I am an Ubuntu user and installed Ruby with the aptitude package manager so I could easily update to a later version of Ruby when it was released. The problem here is the package sources won?t be updated right away and I will be stuck with the vulnerability until new packages are created and put out. I probably won?t be effected by this issue as I have not yet but I would rather be safe, especially for my customers.

Having used a package manager, Ruby is installed in:

> ```
> /usr/bin
> ```

The options at this point is to download and build Ruby from source. Building Ruby from the Ruby website will by default but Ruby in:

> ```
> /usr/local/bin
> ```

I won?t get into installing Ruby from source here, there are many good tutorials including one from FiveRuns, [Compiling Ruby, RubyGems and Rails on Ubuntu](http://blog.fiveruns.com/2008/3/3/compiling-ruby-rubygems-and-rails-on-ubuntu). You can use this tutorial for either of your flavors of Ruby. Keep in mind you may need to adjust the PATH setting in your bash script to point to the right Ruby instance. The post above states Ubuntu already has this set already, a quick check of my PATH and it indeed has this set.

One additional option that seems particularly attractive is [Ruby Enterprise Edition](http://www.rubyenterpriseedition.com/index.html) (REE) from Phusion, the Passenger folks. This group keeps on top of Ruby updates and is constantly updating their code. They [posted the DoS vulnerability fix almost right away](http://blog.phusion.nl/2009/06/10/ruby-enterprise-edition-186-20090610-released-fixes-bigdecimal-dos-vulnerability/) and offer the source download or an Ubuntu package for 32 and 64-bit.

This is the option I am taking. I have been wanting to move to REE for some time and I think it now the right time. REE does by default install to the:

> ```
> /opt/ruby_enterprise
> ```

directory, so a change to the bash environment is necessary. The Phusion site has some [good docs on how to install and configure REE](http://www.rubyenterpriseedition.com/documentation.html):

Then follow the instructions that the installer gives you.

> ##### 1.6. Configuring REE as the default Ruby interpreter
> 
> It is possible to configure REE as the default Ruby interpreter, so that when you type *ruby*, *gem*, *irb*, *rake* or other Ruby commands, REE?s version is invoked instead of the system Ruby?s version.
> 
> To do this, you must add REE?s *bin* directory to the beginning of the <tt>PATH</tt> environment variable. This environment variable specifies the command shell?s command search path. For example, you can do this on the command-line:
> 
> ```
> <tt>$ ruby some_program.rb    # <--- some_program.rb is being run
> #      in the system Ruby interpreter.
> $ export PATH=/opt/ruby-enterprise-X.X.X/bin:$PATH
> $ ruby some_program.rb    # <--- some_program.rb will now be run in REE!</tt>
> ```
> 
> Invoking <tt>export PATH=...</tt> on the command-line has no permanent effect: its effects disappear as soon as you exit the shell. To make the effect permanent, add an entry to the file<tt>/etc/environment</tt> instead. On Ubuntu Linux, <tt>/etc/environment</tt> looks like this:
> 
> ```
> <tt>PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games"
> LANG="en_US.UTF-8"
> LANGUAGE="en_US:en"</tt>
> ```
> 
> Add REE?s *bin* directory to the PATH environment variable, like this:
> 
> ```
> <tt>PATH="/opt/ruby-enterprise-x.x.x/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games"
> LANG="en_US.UTF-8"
> LANGUAGE="en_US:en"</tt>
> ```

This will give me both better memory usage and the added security of fixing BigDecimal.

This does effect Ruby on Rails and there is a [patch to Rails as a quick workaround](http://weblog.rubyonrails.org/2009/6/10/dos-vulnerability-in-ruby).

### Conclusion

It is great to have options and open source gives us the ability to have many. If building from source is the way to go then keep in mind all of the RubyGems already installed in the system(s) need to be installed again for that new version of Ruby. This only applies if the Ruby path is changed to which Ruby is being used.

<div class="wlWriterEditableSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:0be621ba-8819-4e1c-96eb-e3c4e5639921" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">Technorati Tags: [Ruby](http://technorati.com/tags/Ruby),[Ruby Enterprise Edition](http://technorati.com/tags/Ruby+Enterprise+Edition),[REE](http://technorati.com/tags/REE),[JRuby](http://technorati.com/tags/JRuby),[Rails](http://technorati.com/tags/Rails),[DoS Vulnerability](http://technorati.com/tags/DoS+Vulnerability)</div>